# ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” WeddingAI ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ë° ì¡°íšŒ ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### ì£¼ìš” í…Œì´ë¸”

1. **User** - ì‚¬ìš©ì ì •ë³´
   - `id`: ê³ ìœ  ID (cuid)
   - `email`: ì´ë©”ì¼ (ê³ ìœ )
   - `name`: ì‚¬ìš©ì ì´ë¦„
   - `credits`: ë³´ìœ  í¬ë ˆë”§
   - `createdAt`: ê°€ì…ì¼
   - `updatedAt`: ìµœì¢… ìˆ˜ì •ì¼

2. **Account** - OAuth ê³„ì • ì—°ê²°
   - `id`: ê³ ìœ  ID
   - `userId`: ì‚¬ìš©ì ID (ì™¸ë˜í‚¤)
   - `provider`: OAuth ì œê³µì (google, kakao ë“±)
   - `type`: ê³„ì • íƒ€ì…
   - `access_token`, `refresh_token`: í† í° ì •ë³´

3. **Session** - ì„¸ì…˜ ê´€ë¦¬
   - `id`: ê³ ìœ  ID
   - `userId`: ì‚¬ìš©ì ID (ì™¸ë˜í‚¤)
   - `sessionToken`: ì„¸ì…˜ í† í° (ê³ ìœ )
   - `expires`: ë§Œë£Œ ì‹œê°„

4. **Order** - ì£¼ë¬¸/ê²°ì œ ë‚´ì—­
   - `id`: ê³ ìœ  ID
   - `userId`: ì‚¬ìš©ì ID (ì™¸ë˜í‚¤)
   - `amount`: ê²°ì œ ê¸ˆì•¡
   - `credits`: êµ¬ë§¤ í¬ë ˆë”§
   - `status`: ì£¼ë¬¸ ìƒíƒœ (PENDING, COMPLETED, FAILED)

5. **GeneratedImage** - ìƒì„±ëœ ì´ë¯¸ì§€
   - `id`: ê³ ìœ  ID
   - `userId`: ì‚¬ìš©ì ID (ì™¸ë˜í‚¤)
   - `originalUrl`: ì›ë³¸ ì´ë¯¸ì§€ URL
   - `generatedUrl`: ìƒì„±ëœ ì´ë¯¸ì§€ URL
   - `prompt`: ìƒì„± í”„ë¡¬í”„íŠ¸
   - `style`: ì„ íƒí•œ ìŠ¤íƒ€ì¼
   - `status`: ìƒì„± ìƒíƒœ (PROCESSING, COMPLETED, FAILED)

## ğŸ” ë°ì´í„° ì¡°íšŒ ë°©ë²•

### 1. Prisma Studio (GUI ë„êµ¬) â­ ì¶”ì²œ

ê°€ì¥ ì§ê´€ì ì´ê³  í¸ë¦¬í•œ ë°©ë²•ì…ë‹ˆë‹¤.

```bash
npm run db:studio
```

**ì ‘ì†:** http://localhost:5555

**ê¸°ëŠ¥:**
- âœ… ëª¨ë“  í…Œì´ë¸” ì‹œê°ì ìœ¼ë¡œ íƒìƒ‰
- âœ… ë°ì´í„° ê²€ìƒ‰, í•„í„°ë§, ì •ë ¬
- âœ… ë°ì´í„° ì¶”ê°€, ìˆ˜ì •, ì‚­ì œ
- âœ… ê´€ê³„(Relation) íƒìƒ‰
- âœ… ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

**ì‚¬ìš© ì˜ˆì‹œ:**
1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:5555 ì ‘ì†
2. ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ í…Œì´ë¸” ì„ íƒ (ì˜ˆ: User)
3. ë°ì´í„° í™•ì¸ ë° í•„í„° ì ìš©
4. íŠ¹ì • í–‰ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ í™•ì¸
5. ê´€ë ¨ ë°ì´í„°(orders, images ë“±) ë°”ë¡œ í™•ì¸

### 2. ë¹ ë¥¸ í†µê³„ í™•ì¸

ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ í†µê³„ë¥¼ í•œëˆˆì— í™•ì¸í•©ë‹ˆë‹¤.

```bash
npm run db:check:stats
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ í†µê³„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘¥ ì‚¬ìš©ì: 15ëª…
ğŸ“± ê³„ì • ì—°ê²°: 15ê°œ
ğŸ” í™œì„± ì„¸ì…˜: 8ê°œ
ğŸ’° ì£¼ë¬¸: 23ê±´
ğŸ–¼ï¸  ìƒì„± ì´ë¯¸ì§€: 47ê°œ
```

### 3. ìƒì„¸ ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ

ëª¨ë“  ì‚¬ìš©ìì˜ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

```bash
npm run db:check:users
```

**ì¶œë ¥ ì˜ˆì‹œ:**
```
============================================================
ğŸ‘¤ ì‚¬ìš©ì #1
============================================================
ID: clx1234567890abcdefgh
ì´ë¦„: í™ê¸¸ë™
ì´ë©”ì¼: hong@example.com
í¬ë ˆë”§: 5
ê°€ì…ì¼: 2024-12-01 14:23:45
ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2024-12-15 10:15:30

ğŸ“± ì—°ê²°ëœ ê³„ì •: 1ê°œ
  - google (oauth)

ğŸ” í™œì„± ì„¸ì…˜: 1ê°œ
  - ë§Œë£Œ: 2024-12-30 14:23:45

ğŸ’° ì£¼ë¬¸ ë‚´ì—­: 2ê°œ
  - COMPLETED | 10í¬ë ˆë”§ | 2024-12-05 09:30:00
  - COMPLETED | 5í¬ë ˆë”§ | 2024-12-10 15:45:00

ğŸ–¼ï¸  ìƒì„± ì´ë¯¸ì§€: ì´ 8ê°œ (ìµœê·¼ 5ê°œë§Œ í‘œì‹œ)
  - COMPLETED | classic | 2024-12-15 10:00:00
  - COMPLETED | modern | 2024-12-14 16:30:00
  ...
```

### 4. ìœ ì—°í•œ ì¡°íšŒ ì˜µì…˜

ë‹¤ì–‘í•œ ì¡°íšŒ ì˜µì…˜ì„ ì œê³µí•©ë‹ˆë‹¤.

```bash
# ì „ì²´ í†µê³„
npm run db:check
npm run db:check stats

# ì‚¬ìš©ì ëª©ë¡ (ê°„ë‹¨)
npm run db:check users

# ìµœê·¼ í™œë™ (ìµœê·¼ 10ê°œ ì´ë¯¸ì§€)
npm run db:check recent
```

**ì‚¬ìš©ì ëª©ë¡ ì¶œë ¥ ì˜ˆì‹œ:**
```
ğŸ‘¥ ì‚¬ìš©ì ëª©ë¡
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
hong@example.com | í™ê¸¸ë™ | 5í¬ë ˆë”§
kim@example.com | ê¹€ì² ìˆ˜ | 3í¬ë ˆë”§
lee@example.com | ì´ì˜í¬ | 10í¬ë ˆë”§
```

**ìµœê·¼ í™œë™ ì¶œë ¥ ì˜ˆì‹œ:**
```
ğŸ•’ ìµœê·¼ ì´ë¯¸ì§€ ìƒì„± (10ê°œ)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2024-12-15 10:00:00 | hong@example.com | COMPLETED
2024-12-14 16:30:00 | kim@example.com | PROCESSING
2024-12-14 14:15:00 | lee@example.com | COMPLETED
...
```

## ğŸ›  ë°ì´í„°ë² ì´ìŠ¤ ê´€ë¦¬ ëª…ë ¹ì–´

### ìŠ¤í‚¤ë§ˆ ê´€ë¦¬

```bash
# Prisma Client ìƒì„±/ì¬ìƒì„±
npm run db:generate

# ìŠ¤í‚¤ë§ˆë¥¼ DBì— í‘¸ì‹œ (ê°œë°œ í™˜ê²½)
npm run db:push

# ë§ˆì´ê·¸ë ˆì´ì…˜ ë°°í¬ (í”„ë¡œë•ì…˜)
npm run db:migrate
```

### ë°ì´í„° ì¡°íšŒ

```bash
# GUI ë„êµ¬ ì‹¤í–‰
npm run db:studio

# ë¹ ë¥¸ í†µê³„
npm run db:check:stats

# ìƒì„¸ ì‚¬ìš©ì ì •ë³´
npm run db:check:users

# ì»¤ìŠ¤í…€ ì¡°íšŒ
npm run db:check [ì˜µì…˜]
```

## ğŸ’¡ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆë¡œìš´ ì‚¬ìš©ìê°€ ê°€ì…í–ˆëŠ”ì§€ í™•ì¸

```bash
npm run db:studio
```
â†’ User í…Œì´ë¸”ì—ì„œ ìµœì‹  ë°ì´í„° í™•ì¸

### ì‹œë‚˜ë¦¬ì˜¤ 2: íŠ¹ì • ì‚¬ìš©ìì˜ í¬ë ˆë”§ í™•ì¸

```bash
npm run db:check:users
```
â†’ ì´ë©”ì¼ë¡œ ì°¾ì•„ì„œ í¬ë ˆë”§ í™•ì¸

ë˜ëŠ” Prisma Studioì—ì„œ User í…Œì´ë¸” â†’ ì´ë©”ì¼ ê²€ìƒ‰

### ì‹œë‚˜ë¦¬ì˜¤ 3: ìµœê·¼ ê²°ì œ ë‚´ì—­ í™•ì¸

```bash
npm run db:studio
```
â†’ Order í…Œì´ë¸” â†’ createdAtìœ¼ë¡œ ì •ë ¬

### ì‹œë‚˜ë¦¬ì˜¤ 4: ì‹¤íŒ¨í•œ ì´ë¯¸ì§€ ìƒì„± í™•ì¸

```bash
npm run db:studio
```
â†’ GeneratedImage í…Œì´ë¸” â†’ status í•„í„° (FAILED)

### ì‹œë‚˜ë¦¬ì˜¤ 5: ì „ì²´ ì‹œìŠ¤í…œ í˜„í™© íŒŒì•…

```bash
npm run db:check:stats
```
â†’ ë¹ ë¥´ê²Œ ì „ì²´ í†µê³„ í™•ì¸

## ğŸ”’ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­

1. **Prisma StudioëŠ” ê°œë°œ í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©**
   - í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì ˆëŒ€ ì‹¤í–‰í•˜ì§€ ë§ ê²ƒ
   - í¬íŠ¸ 5555ëŠ” ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨ í•„ìˆ˜

2. **ë¯¼ê°í•œ ì •ë³´ ë³´í˜¸**
   - `access_token`, `refresh_token` ë“±ì€ ì ˆëŒ€ ë³µì‚¬/ê³µìœ  ê¸ˆì§€
   - ìŠ¤í¬ë¦°ìƒ· ê³µìœ  ì‹œ ë¯¼ê° ì •ë³´ ë§ˆìŠ¤í‚¹ í•„ìˆ˜

3. **ë°ì´í„° ìˆ˜ì • ê¶Œí•œ**
   - Prisma Studioì—ì„œ ë°ì´í„° ìˆ˜ì •ì€ ì‹ ì¤‘í•˜ê²Œ
   - í”„ë¡œë•ì…˜ DB ì§ì ‘ ìˆ˜ì •ì€ ì ˆëŒ€ ê¸ˆì§€
   - ë°±ì—… í›„ ìˆ˜ì • ê¶Œì¥

## ğŸ“ ì»¤ìŠ¤í…€ ì¿¼ë¦¬ ì‘ì„±

ë” ë³µì¡í•œ ì¡°íšŒê°€ í•„ìš”í•œ ê²½ìš°, `scripts/` í´ë”ì— ìƒˆ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì˜ˆì‹œ: íŠ¹ì • ê¸°ê°„ ë‚´ ì£¼ë¬¸ ì¡°íšŒ**

```typescript
// scripts/check-orders-by-date.ts
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  const startDate = new Date('2024-12-01');
  const endDate = new Date('2024-12-31');

  const orders = await prisma.order.findMany({
    where: {
      createdAt: {
        gte: startDate,
        lte: endDate,
      },
      status: 'COMPLETED',
    },
    include: {
      user: {
        select: {
          email: true,
          name: true,
        },
      },
    },
    orderBy: {
      createdAt: 'desc',
    },
  });

  console.log(`\nğŸ“Š ${startDate.toLocaleDateString()} ~ ${endDate.toLocaleDateString()} ê¸°ê°„ ì£¼ë¬¸ ë‚´ì—­\n`);
  
  orders.forEach((order) => {
    console.log(
      `${order.createdAt.toLocaleString()} | ` +
      `${order.user.email} | ` +
      `${order.credits}í¬ë ˆë”§ | ` +
      `â‚©${order.amount.toLocaleString()}`
    );
  });

  console.log(`\nì´ ${orders.length}ê±´\n`);
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

**ì‹¤í–‰:**
```bash
npx tsx scripts/check-orders-by-date.ts
```

## ğŸ¯ Best Practices

1. **ì •ê¸°ì ì¸ ë°ì´í„° í™•ì¸**
   - ë§¤ì¼ `npm run db:check:stats`ë¡œ ì „ì²´ í˜„í™© í™•ì¸
   - ì´ìƒ ì§•í›„ ë°œê²¬ ì‹œ Prisma Studioë¡œ ìƒì„¸ ì¡°íšŒ

2. **ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§**
   - ëŒ€ëŸ‰ì˜ ì´ë¯¸ì§€ ìƒì„± ì‹œ FAILED ìƒíƒœ í™•ì¸
   - ì„¸ì…˜ ë§Œë£Œ ì£¼ê¸° í™•ì¸

3. **ì‚¬ìš©ì ì§€ì›**
   - ì‚¬ìš©ì ë¬¸ì˜ ì‹œ ì´ë©”ì¼ë¡œ ë¹ ë¥´ê²Œ ì •ë³´ ì¡°íšŒ
   - í¬ë ˆë”§ ì´ìŠˆëŠ” Order í…Œì´ë¸”ë¡œ ê²°ì œ ë‚´ì—­ í™•ì¸

4. **ë°±ì—…**
   - ì¤‘ìš”í•œ ë°ì´í„° ìˆ˜ì • ì „ í•­ìƒ ë°±ì—…
   - SQLite: `dev.db` íŒŒì¼ ë³µì‚¬
   - PostgreSQL: `pg_dump` ì‚¬ìš©

## ğŸ“š ì°¸ê³  ë¬¸ì„œ

- [Prisma Documentation](https://www.prisma.io/docs)
- [Prisma Studio](https://www.prisma.io/studio)
- [í”„ë¡œì íŠ¸ ìŠ¤í‚¤ë§ˆ](../../prisma/schema.prisma)
- [ë¬¸ì„œ ì¸ë±ìŠ¤](../INDEX.md)

---

**ìµœì¢… ì—…ë°ì´íŠ¸:** 2024ë…„ 12ì›” 19ì¼

